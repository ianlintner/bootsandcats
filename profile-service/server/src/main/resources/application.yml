micronaut:
  application:
    name: profile-ui
  server:
    port: ${PROFILE_UI_PORT:8085}
  router:
    static-resources:
      public:
        paths: classpath:public
        mapping: /**
  security:
    enabled: true
    authentication: idtoken
    token-propagation:
      enabled: true
    redirect:
      enabled: true
      login-success: /
      login-failure: /
    intercept-url-map:
      - pattern: /api/status
        http-method: GET
        access: isAnonymous()
      - pattern: /public/**
        http-method: GET
        access: isAnonymous()
      - pattern: /actuator/health
        http-method: GET
        access: isAnonymous()
      - pattern: /actuator/prometheus
        http-method: GET
        access: isAnonymous()
      - pattern: /api/me
        http-method: GET
        access: isAuthenticated()
      - pattern: /api/profile
        http-method: GET
        access: isAuthenticated()
      - pattern: /api/profile
        http-method: POST
        access: isAuthenticated()
      - pattern: /api/profile
        http-method: PUT
        access: isAuthenticated()
      - pattern: /api/profile
        http-method: DELETE
        access: isAuthenticated()
      - pattern: /api/admin/**
        access: isAuthenticated()
      - pattern: /**
        access: isAuthenticated()
    oauth2:
      clients:
        oauth2server:
          client-id: ${OAUTH2_CLIENT_ID:profile-ui}
          client-secret: ${OAUTH2_CLIENT_SECRET:}
          openid:
            issuer: ${OAUTH2_ISSUER_URI:https://oauth2.cat-herding.net}
          authorization:
            url: ${OAUTH2_AUTHORIZATION_URL:}
          token:
            url: ${OAUTH2_TOKEN_URL:}
          scopes:
            - openid
            - profile
            - email
            - profile:read
            - profile:write
            - profile:admin
  metrics:
    enabled: true
    export:
      prometheus:
        enabled: true

# MongoDB/CosmosDB Configuration
mongodb:
  uri: ${MONGODB_URI:mongodb://localhost:27017}
  database: ${MONGODB_DATABASE:profile-db}
  collection:
    profiles: profiles

endpoints:
  all:
    sensitive: false
  health:
    enabled: true
    details-visible: ANONYMOUS
  prometheus:
    enabled: true
