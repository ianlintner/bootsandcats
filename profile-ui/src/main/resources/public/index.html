<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile UI · Boots & Cats</title>
    <!-- Portfolio theme (from npm) served via unpkg -->
    <link rel="stylesheet" href="https://unpkg.com/@ianlintner/theme@0.1.0/dist/styles.css" />
    <style>
      body {
        min-height: 100vh;
        background: radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.18), transparent 35%),
                    radial-gradient(circle at 80% 0%, rgba(236, 72, 153, 0.16), transparent 30%),
                    #0b1120;
        color: #e2e8f0;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
    </style>
  </head>
  <body class="antialiased">
    <main class="mx-auto flex min-h-screen max-w-5xl flex-col gap-12 px-6 py-16 lg:px-12">
      <header class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-primary-600/20 text-primary-200 ring-1 ring-primary-500/50">
            <span class="text-xl font-semibold">BC</span>
          </div>
          <div>
            <p class="text-sm font-semibold uppercase tracking-[0.12em] text-primary-200">Profile UI</p>
            <p class="text-sm text-slate-400">Boots &amp; Cats Authorization Server</p>
          </div>
        </div>
        <a
          id="login-action"
          href="#"
          class="inline-flex items-center gap-2 rounded-full bg-emerald-500/10 px-4 py-2 text-sm font-semibold text-emerald-200 ring-1 ring-emerald-500/40 transition hover:bg-emerald-500/20"
        >
          <span class="h-2 w-2 rounded-full bg-emerald-300"></span>
          Checking session…
        </a>
      </header>

      <section class="grid gap-10 lg:grid-cols-[1.2fr_0.8fr]">
        <div class="space-y-6 rounded-2xl bg-slate-900/70 p-8 shadow-2xl ring-1 ring-white/5 backdrop-blur">
          <p class="text-xs font-semibold uppercase tracking-[0.2em] text-primary-200/80">Portfolio Theme</p>
          <h1 class="text-3xl font-bold text-white sm:text-4xl">Welcome to the Profile UI</h1>
          <p class="max-w-2xl text-base leading-relaxed text-slate-300">
            This UI is styled with the <span class="font-semibold text-primary-100">@ianlintner/theme</span> portfolio theme. If you are not signed in, you will be
            redirected to the OAuth2 Authorization Server to log in. After sign-in, your profile attributes and ID token claims appear below.
          </p>

          <div class="flex flex-wrap gap-4">
            <button
              id="cta-login"
              class="group inline-flex items-center gap-2 rounded-xl bg-primary-500 px-5 py-3 text-base font-semibold text-white shadow-lg shadow-primary-500/30 transition hover:-translate-y-0.5 hover:bg-primary-400"
            >
              <span>Login via Authorization Server</span>
              <span aria-hidden="true" class="transition group-hover:translate-x-0.5">→</span>
            </button>
            <a
              href="/actuator/info"
              class="inline-flex items-center gap-2 rounded-xl bg-white/5 px-5 py-3 text-base font-semibold text-slate-100 ring-1 ring-white/10 transition hover:bg-white/10"
            >
              <span>Service info</span>
            </a>
          </div>
        </div>

        <div class="grid gap-4">
          <article class="rounded-2xl bg-white/5 p-6 ring-1 ring-white/10 backdrop-blur">
            <div class="flex items-center gap-3">
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-primary-500/20 text-primary-100 ring-1 ring-primary-400/40">01</div>
              <div>
                <p class="text-sm font-semibold text-white">Start authentication</p>
                <p class="text-sm text-slate-300">Click “Login via Authorization Server” to launch the OAuth2 Authorization Code flow.</p>
              </div>
            </div>
          </article>
          <article class="rounded-2xl bg-white/5 p-6 ring-1 ring-white/10 backdrop-blur">
            <div class="flex items-center gap-3">
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-primary-500/20 text-primary-100 ring-1 ring-primary-400/40">02</div>
              <div>
                <p class="text-sm font-semibold text-white">Review your claims</p>
                <p class="text-sm text-slate-300">After sign-in, the app will display your profile attributes, ID token, and granted scopes.</p>
              </div>
            </div>
          </article>
          <article class="rounded-2xl bg-white/5 p-6 ring-1 ring-white/10 backdrop-blur">
            <div class="flex items-center gap-3">
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-primary-500/20 text-primary-100 ring-1 ring-primary-400/40">03</div>
              <div>
                <p class="text-sm font-semibold text-white">Sign out securely</p>
                <p class="text-sm text-slate-300">Use the logout control to end your session and clear tokens from the browser.</p>
              </div>
            </div>
          </article>

          <article class="rounded-2xl bg-white/5 p-6 ring-1 ring-white/10 backdrop-blur">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="text-sm font-semibold text-white">Authenticated user</p>
                <p id="user-name" class="text-sm text-slate-300">Fetching profile…</p>
              </div>
              <button
                id="cta-logout"
                class="rounded-lg bg-white/10 px-3 py-2 text-xs font-semibold text-slate-100 ring-1 ring-white/15 transition hover:bg-white/20"
              >
                Logout
              </button>
            </div>
            <div class="mt-4 grid gap-2 text-sm text-slate-200" id="user-claims"></div>
          </article>
        </div>
      </section>

      <footer class="flex flex-col gap-3 border-t border-white/5 pt-8 text-sm text-slate-400 sm:flex-row sm:items-center sm:justify-between">
        <p class="text-slate-300">Powered by Boots &amp; Cats · Micronaut</p>
        <div class="flex flex-wrap gap-3">
          <a class="hover:text-primary-100" href="/actuator/health">Health</a>
          <a class="hover:text-primary-100" href="/actuator/prometheus">Metrics</a>
          <a class="hover:text-primary-100" href="https://oauth2.cat-herding.net">Authorization Server</a>
        </div>
      </footer>
    </main>
    <script>
      const loginPath = "/oauth/login/oauth2server";
      const logoutPath = "/logout";

      const loginButton = document.getElementById("cta-login");
      const loginAction = document.getElementById("login-action");
      const logoutButton = document.getElementById("cta-logout");
      const userNameEl = document.getElementById("user-name");
      const userClaimsEl = document.getElementById("user-claims");

      function redirectToLogin() {
        window.location.href = loginPath;
      }

      loginButton.addEventListener("click", redirectToLogin);
      loginAction.addEventListener("click", redirectToLogin);

      logoutButton.addEventListener("click", () => {
        window.location.href = logoutPath;
      });

      async function loadProfile() {
        try {
          const response = await fetch("/api/me", { credentials: "include" });

          if (response.status === 401 || response.status === 403) {
            loginAction.innerText = "Redirecting to login…";
            redirectToLogin();
            return;
          }

          if (!response.ok) {
            loginAction.innerText = "Unable to load session";
            return;
          }

          const data = await response.json();
          loginAction.innerText = "Signed in";
          loginAction.classList.remove("bg-emerald-500/10");
          loginAction.classList.add("bg-primary-500/15", "text-primary-100", "ring-primary-500/30");

          userNameEl.innerText = data.name || "Authenticated";
          userClaimsEl.innerHTML = "";

          const claims = data.attributes || {};
          Object.keys(claims).forEach((key) => {
            const value = claims[key];
            const item = document.createElement("div");
            item.className = "flex items-start justify-between gap-3 rounded-lg bg-white/5 px-3 py-2";
            item.innerHTML = `<span class="text-slate-300">${key}</span><span class="text-slate-100 text-right">${typeof value === "object" ? JSON.stringify(value) : value}</span>`;
            userClaimsEl.appendChild(item);
          });
        } catch (e) {
          loginAction.innerText = "Session check failed";
        }
      }

      loadProfile();
    </script>
  </body>
</html>
