# Profile: prod-no-db
#
# Purpose: Run the OAuth2 server with NO database dependencies (no Postgres, no Flyway, no JPA).
# Durable configuration is expected to come from Kubernetes CRDs (clients/scopes/deny rules),
# and runtime session state can be backed by Redis.

# Disable Flyway and all DB/JPA auto-configuration.
# This prevents Spring Boot from attempting to create a DataSource/Hikari pool and JPA EntityManager.
#
# Note: leaving spring.datasource.* properties present in other profiles is fine as long as the
# relevant auto-configurations are excluded here.
#
# Disable the auto-configurations that would otherwise create a JDBC DataSource, Hibernate/JPA,
# and Spring Data JPA repositories.
#
# Note: In Spring Boot 4, many auto-configurations moved out of spring-boot-autoconfigure into
# dedicated modules (e.g. spring-boot-jdbc, spring-boot-hibernate, spring-boot-data-jpa). Ensure
# we exclude the *Spring Boot 4* class names.
spring.autoconfigure.exclude=org.springframework.boot.jdbc.autoconfigure.DataSourceAutoConfiguration,org.springframework.boot.jdbc.autoconfigure.DataSourceInitializationAutoConfiguration,org.springframework.boot.jdbc.autoconfigure.DataSourceTransactionManagerAutoConfiguration,org.springframework.boot.hibernate.autoconfigure.HibernateJpaAutoConfiguration,org.springframework.boot.data.jpa.autoconfigure.DataJpaRepositoriesAutoConfiguration

# Ensure schema validation is not attempted.
spring.jpa.hibernate.ddl-auto=none
spring.flyway.enabled=false

# Belt-and-suspenders: explicitly disable JPA repositories.
spring.data.jpa.repositories.enabled=false

# Explicitly select Kubernetes-backed stores so default (matchIfMissing) DB/JPA implementations
# do not activate when running without a database.
oauth2.clients.store=kubernetes
oauth2.deny.store=kubernetes
