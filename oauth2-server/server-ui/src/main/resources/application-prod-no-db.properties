# Profile: prod-no-db
#
# Purpose: Run the OAuth2 server with NO database dependencies (no Postgres, no Flyway, no JPA).
# Durable configuration is expected to come from Kubernetes CRDs (clients/scopes/deny rules),
# and runtime session state can be backed by Redis.

# Disable Flyway and all DB/JPA auto-configuration.
# This prevents Spring Boot from attempting to create a DataSource/Hikari pool and JPA EntityManager.
#
# Note: leaving spring.datasource.* properties present in other profiles is fine as long as the
# relevant auto-configurations are excluded here.
#
# Disable the auto-configurations that would otherwise create a JDBC DataSource, Hibernate/JPA,
# Spring Data JPA repositories, and Flyway.
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,org.springframework.boot.autoconfigure.data.jpa.DataJpaRepositoriesAutoConfiguration,org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration

# Ensure schema validation is not attempted.
spring.jpa.hibernate.ddl-auto=none
spring.flyway.enabled=false

# Belt-and-suspenders: explicitly disable JPA repositories.
spring.data.jpa.repositories.enabled=false

# Explicitly select Kubernetes-backed stores so default (matchIfMissing) DB/JPA implementations
# do not activate when running without a database.
oauth2.clients.store=kubernetes
oauth2.deny.store=kubernetes
