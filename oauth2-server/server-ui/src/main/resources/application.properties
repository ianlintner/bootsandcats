# Application Configuration
spring.application.name=oauth2-authorization-server
server.port=9000

# Logging
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG
logging.level.org.springframework.security.oauth2.server.authorization=TRACE
logging.level.com.bootsandcats=DEBUG
logging.level.com.bootsandcats.oauth2=DEBUG

# Database Configuration (H2 for development)
spring.datasource.url=jdbc:h2:mem:oauth2db;MODE=PostgreSQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
# Flyway manages schema; don't validate on startup (Flyway runs first)
spring.flyway.enabled=true
spring.flyway.url=${spring.datasource.url}
spring.flyway.user=${spring.datasource.username}
spring.flyway.password=${spring.datasource.password}
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.jpa.hibernate.ddl-auto=none
spring.jpa.defer-datasource-initialization=false
spring.flyway.placeholders.profile_service_client_secret={noop}${OAUTH2_DEMO_CLIENT_SECRET:demo-secret}

# HikariCP connection pool settings
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# WARNING: H2 console should only be enabled in development environments.
# This is disabled by default in application-prod.properties.
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# JPA Configuration
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.show-sql=false

# Thymeleaf Configuration
spring.thymeleaf.check-template-location=false

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,prometheus,metrics,env
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true
management.health.redis.enabled=true
management.info.env.enabled=true
management.prometheus.metrics.export.enabled=true

# Spring Boot Admin Configuration
spring.boot.admin.client.url=http://localhost:9000
spring.boot.admin.client.instance.management-base-url=http://localhost:9000
spring.boot.admin.ui.title=OAuth2 Authorization Server Admin
# spring.boot.admin.context-path=/admin

# OpenTelemetry Configuration
otel.exporter.otlp.endpoint=http://localhost:4317
otel.exporter.otlp.protocol=grpc
otel.service.name=oauth2-authorization-server
otel.traces.exporter=otlp
# Metrics handled by Micrometer Prometheus registry, not OTel Prometheus exporter
otel.metrics.exporter=none
otel.logs.exporter=otlp

# Tracing (Micrometer Tracing -> OTLP)
# Prefer these properties for application-level tracing.
management.tracing.enabled=true
management.tracing.sampling.probability=${TRACING_SAMPLING_PROBABILITY:0.1}
# OTLP HTTP endpoint (recommended). Default points to local OTEL Collector.
management.otlp.tracing.endpoint=${OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:http://localhost:4318/v1/traces}

# Application Info
info.app.name=OAuth2 Authorization Server
info.app.description=Spring Boot OAuth2 Authorization Server with OIDC and PKCE support
info.app.version=1.0.0

# OAuth2 Client Configuration (Federated Login)
# GitHub
spring.security.oauth2.client.registration.github.client-id=${GITHUB_CLIENT_ID:placeholder-id}
spring.security.oauth2.client.registration.github.client-secret=${GITHUB_CLIENT_SECRET:placeholder-secret}
spring.security.oauth2.client.registration.github.scope=read:user,user:email

# Google
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:placeholder-id}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:placeholder-secret}
spring.security.oauth2.client.registration.google.scope=openid,profile,email
spring.security.oauth2.client.registration.google.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

# Azure AD (Microsoft Entra ID)
spring.security.oauth2.client.registration.azure.provider=azure
spring.security.oauth2.client.registration.azure.client-id=${AZURE_CLIENT_ID:placeholder-id}
spring.security.oauth2.client.registration.azure.client-secret=${AZURE_CLIENT_SECRET:placeholder-secret}
spring.security.oauth2.client.registration.azure.scope=openid,profile,email,User.Read
spring.security.oauth2.client.registration.azure.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.azure.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

# Azure AD provider endpoints (using environment variable for tenant ID)
spring.security.oauth2.client.provider.azure.authorization-uri=https://login.microsoftonline.com/${AZURE_TENANT_ID:42ddc44e-97dd-4c3b-bf8a-31c785e24c67}/oauth2/v2.0/authorize
spring.security.oauth2.client.provider.azure.token-uri=https://login.microsoftonline.com/${AZURE_TENANT_ID:42ddc44e-97dd-4c3b-bf8a-31c785e24c67}/oauth2/v2.0/token
spring.security.oauth2.client.provider.azure.user-info-uri=https://graph.microsoft.com/oidc/userinfo
spring.security.oauth2.client.provider.azure.jwk-set-uri=https://login.microsoftonline.com/${AZURE_TENANT_ID:42ddc44e-97dd-4c3b-bf8a-31c785e24c67}/discovery/v2.0/keys
spring.security.oauth2.client.provider.azure.user-name-attribute=sub

# Session Configuration
server.servlet.session.cookie.http-only=true
# WARNING: secure=false is for development only. This is overridden to 'true' in application-prod.properties.
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=lax
server.servlet.session.timeout=30m

# Spring Session Configuration
# Set to "redis" to enable Redis session storage (requires Redis server)
# Set to "none" to use default in-memory sessions (development)
spring.session.store-type=${SESSION_STORE_TYPE:none}

# Redis Configuration (used when spring.session.store-type=redis)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.enabled=true
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=2
spring.data.redis.lettuce.pool.max-wait=1000ms

# Error Handling

# OAuth2 Configuration (override with environment variables in production)
oauth2.issuer-url=${OAUTH2_ISSUER_URL:http://localhost:9000}
oauth2.demo-client-secret=${OAUTH2_DEMO_CLIENT_SECRET:demo-secret}
oauth2.m2m-client-secret=${OAUTH2_M2M_CLIENT_SECRET:m2m-secret}
oauth2.demo-user-password=${OAUTH2_DEMO_USER_PASSWORD:password}
oauth2.admin-user-password=${OAUTH2_ADMIN_USER_PASSWORD:admin}

# Auth event streaming (Redis)
auth.events.enabled=${AUTH_EVENTS_ENABLED:true}
auth.events.stream-name=${AUTH_EVENTS_STREAM:auth:events}
auth.events.max-length=${AUTH_EVENTS_MAX_LENGTH:1000}

# OpenAPI / Swagger UI Configuration
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.doc-expansion=none
springdoc.swagger-ui.try-it-out-enabled=true
springdoc.swagger-ui.filter=true
springdoc.show-actuator=false
# Include OAuth2 endpoints in OpenAPI documentation
springdoc.paths-to-match=/oauth2/**,/userinfo,/actuator/**

# Azure Key Vault JWK Configuration
azure.keyvault.enabled=${AZURE_KEYVAULT_ENABLED:false}
azure.keyvault.vault-uri=${AZURE_KEYVAULT_URI:}
azure.keyvault.jwk-secret-name=${AZURE_JWK_SECRET_NAME:oauth2-jwk}
azure.keyvault.cache-ttl=${AZURE_JWK_CACHE_TTL:PT10M}
